# Тестовое задание для STARPETS.GG

Первая часть. Веб-приложение с ручкой для изменения баланса.

### Что использовал

- Node.js v20.12
- PostgreSQL 15
- Docker

### Запуск

```bash
cp .env.example .env
docker-compose up --build
```

### Миграции

Миграции и сиды настроены с помощью Sequelize-cli и отработают при первом запуске приложения. И миграции, и сиды хранятся в БД.

### Документация

### Method: PATCH

> ```
> ${host}/api/users/:id/balance
> ```

Для теста всегда создается один пользователем с фиксированным id: 29b3a37d-2a8b-4c3a-80b2-b1cc64d2bf7f

### Body (**raw**)

```json
{
  "amount": -2
}
```

### Response: 400

Не прошел валидацию/не существует такого пользователя

```json
{
  "success": false,
  "message": "invalid body"
}
```

### Response: 400

Не хватило денег для снятия

```json
{
  "success": false,
  "message": "insufficient funds"
}
```

### Response: 200

Деньги списались/начислились

```json
{
  "success": true,
  "data": {
    "balance": 9996
  }
}
```

### Чем тестировал

Использовал autocannon со стандартными настройками
Для повышения производительности выключил полностью логи sequelize

Запуск теста `npm run test:load`

#### По поводу использования одной схемы для миграции и модели

В сообщении к тестовому заданию был комментарий, что нужно реализовать модели и миграции без дублирования структуры таблиц. Мной был выбран наиболее прямолинейный вариант - использование общей схемы для моделей и миграций, но я прекрасно понимаю, что это далеко не самый лучший вариант, потому что, как только модель меняется - миграция отстает, нарушается консистентность. Буду очень рад узнать о способах решения этой проблемы.
